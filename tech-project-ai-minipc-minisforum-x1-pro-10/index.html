<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Tech Project: AI miniPC (Minisforum X1 Pro) 1.0 - XS Tech Thoughts</title><meta name="description" content="Xavier Santana of XS Tech Thoughts does initial testing of the Minisforum X1 Pro miniPC as an AI and Unreal Engine 5 workstation."><meta name="generator" content="Publii Open-Source CMS for Static Site"><!-- Global site tag (gtag.js) - Google Analytics --><script type="gdpr-blocker/Analytics" async src="https://www.googletagmanager.com/gtag/js?id=G-EHLH28GQMY"></script><script type="gdpr-blocker/Analytics">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-EHLH28GQMY' , { 'anonymize_ip': true });
				  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EHLH28GQMY"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EHLH28GQMY');</script><link rel="stylesheet" href="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-black.css"><link rel="stylesheet" href="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://korgano.github.io/tech-project-ai-minipc-minisforum-x1-pro-10/"><link rel="alternate" type="application/atom+xml" href="https://korgano.github.io/feed.xml" title="XS Tech Thoughts - RSS"><meta property="og:title" content="Tech Project: AI miniPC (Minisforum X1 Pro) 1.0"><meta property="og:image" content="https://korgano.github.io/media/posts/46/minipc-001-2.png"><meta property="og:image:width" content="1902"><meta property="og:image:height" content="921"><meta property="og:site_name" content="XS Tech Thoughts"><meta property="og:description" content="Xavier Santana of XS Tech Thoughts does initial testing of the Minisforum X1 Pro miniPC as an AI and Unreal Engine 5 workstation."><meta property="og:url" content="https://korgano.github.io/tech-project-ai-minipc-minisforum-x1-pro-10/"><meta property="og:type" content="article"><link rel="preload" href="https://korgano.github.io/assets/dynamic/fonts/robotoflex/robotoflex.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://korgano.github.io/assets/dynamic/fonts/robotoslab/robotoslab.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://korgano.github.io/assets/css/style.css?v=253922ed3c1816ffff870ea807b853dd"><link rel="stylesheet" href="https://korgano.github.io/assets/css/photoswipe.css?v=da6e9be0fa855edd3610e97c1d4e38d9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://korgano.github.io/tech-project-ai-minipc-minisforum-x1-pro-10/"},"headline":"Tech Project: AI miniPC (Minisforum X1 Pro) 1.0","datePublished":"2025-08-07T12:02-04:00","dateModified":"2025-08-12T15:38-04:00","image":{"@type":"ImageObject","url":"https://korgano.github.io/media/posts/46/minipc-001-2.png","height":921,"width":1902},"description":"Xavier Santana of XS Tech Thoughts does initial testing of the Minisforum X1 Pro miniPC as an AI and Unreal Engine 5 workstation.","author":{"@type":"Person","name":"Xavier Santana","url":"https://korgano.github.io/authors/xavier-santana/"},"publisher":{"@type":"Organization","name":"Xavier Santana"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template lines"><div class="container lines lines--right"><header class="header"><a href="https://korgano.github.io/" class="logo">XS Tech Thoughts</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu">Menu</button><ul class="navbar__menu"><li><a href="https://korgano.github.io/" title="Home" target="_self">Home</a></li><li><a href="https://korgano.github.io/tags/uxui-case-study/" title="UX/UI Case Studies" target="_blank">UX/UI Case Studies</a></li><li><a href="https://korgano.github.io/tags/cybersecurity-projects/" title="Cybersecurity Projects" target="_blank">Cybersecurity Projects</a></li><li><a href="https://korgano.github.io/tags/quick-thoughts/" title="Quick Thoughts" target="_self">Quick Thoughts</a></li><li><a href="https://korgano.github.io/about-me/" title="About Me" target="_blank">About Me</a></li></ul></nav></header><main class="main post"><article class="content"><header class="content__inner content__header"><h1 class="content__title">Tech Project: AI miniPC (Minisforum X1 Pro) 1.0</h1><div class="content__meta"><div class="content__meta__left"><a href="https://korgano.github.io/authors/xavier-santana/" class="invert content__author" rel="author" title="Xavier Santana">Xavier Santana</a></div><div class="content__meta__right"><time datetime="2025-08-07T12:02" class="content__date">August 7, 2025</time><div class="content__updated">Updated on <time datetime="2025-08-07T12:02" class="content__date">August 12, 2025</time></div></div></div></header><figure class="content__featured-image"><div class="content__featured-image__inner is-img-loading"><img src="https://korgano.github.io/media/posts/46/minipc-001-2.png" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-001-2-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-001-2-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-001-2-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-001-2-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-001-2-xl.png 1600w" sizes="(min-width: 37.5em) 1600px, 80vw" loading="eager" height="921" width="1902" alt="Amazon product page for the MINISFORUM AI X1 Pro-370 Mini PC."></div></figure><div class="content__inner"><div class="content__entry"><p>For many people, tech products are on a 3-4 year lifecycle, assuming that nothing catastrophic occurs, like the COVID and cryptocurrency demand spikes.</p><p>Four years ago, I got a Lenovo Legion laptop with Ryzen 7 5800H and 6600M to replace a Dell G5 AMD laptop that failed right after the one year warranty expired. The Lenovo Legion was and is still pretty capable at the lighter code compile and graphics workloads I find myself doing, but it has three major constraints:</p><ul><li>Limited cooling due to the laptop form factor.</li><li>No real ability to do AI workloads.</li><li>Limited VRAM.</li></ul><p>On the other hand, I have a mid-tower desktop PC containing a Ryzen 7 7800X3D and a Radeon RX 7900 XTX. This is more than capable of handling AI workloads and has plenty of cooling. There are two major constraints on this system:</p><ul><li>It uses a lot of energy.</li><li>It's in a separate room.</li></ul><p>Even with a NAS to facilitate file transfers and the mindset benefits of two separate workspaces, it's <strong>massively </strong>inconvenient to have to work in two locations. The constant back and forth eats up time, especially in situations where a workload on the gaming PC takes a while. And for text based AI work, the RX 7900 XTX is <strong>massive </strong>overkill, providing fantastic performance with a 24GB VRAM buffer, but at a high power draw for a trivial task.</p><p>When I heard about Strix Halo via tech news and leak channel Moore's Law is Dead, the idea of a mobile workstation with a lot of RAM was appealing. Unfortunately, the reality is that the most future-proof/high longevity configurations - the ones with the most RAM - cost $2000. And $2000 is a lot to invest in any system.</p><p>So I needed to find an alternative.</p><p> </p><div class="post__toc"><h3>Table of Contents</h3><ul><li><a href="#mcetoc_1j22nc59ee3">The Least Worst of All Worlds</a></li><li><a href="#mcetoc_1j2ff0lemv6">The Alternatives</a></li><li><a href="#mcetoc_1j2ff0lemv7">Setting up the X1 Pro</a></li><li><a href="#mcetoc_1j2ff0lemv8">Stress Testing the X1 Pro</a></li></ul></div><h2 id="mcetoc_1j22nc59ee3">The Least Worst of All Worlds</h2><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-001.png" alt="Amazon product page for the MINISFORUM AI X1 Pro-370 Mini PC." width="1902" height="921" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-001-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-001-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-001-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-001-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-001-xl.png 1600w"></figure><p>Let's start with what I chose and work back to the <strong>why</strong>.</p><p>The <span id="productTitle" class="a-size-large product-title-word-break">MINISFORUM AI X1 Pro-370 Mini PC (hereafter the X1 Pro) is a Strix Point based miniPC. This is the second tier of AMD's AI focused APUs, which combine a powerful CPU with a GPU on the same chip. It predates the Strix Halo line by several months, so it has less impressive specifications overall.</span></p><p>The feature set in the <a href="https://www.amazon.com/dp/B0F47G69MJ" title="MINISFORUM AI X1 Pro-370 Mini PC" target="_blank" rel="noopener noreferrer">product blurb</a> is as follows:</p><blockquote><span class="a-list-item">【Leading AI Mini PC】MINISFORUM AI X1 Pro-370 Mini PC comes with AMD Ryzen AI 9 HX 370 processor, which uses AMD's latest generation Zen 5 architecture. It has 12 Cores and 24 Threads, the boost clock is up to 5.1GHz. The overall processor performance is up to 80 TOPS, and the NPU performance reaches up to 50 TOPS. AMD Ryzen AI enables improved productivity, advanced collaboration, and improved efficiency.</span></blockquote><blockquote><span class="a-list-item">【AMD Radeon 890M Graphics】The X1 Pro Micro Computer equipped with AMD Radeon 890M Graphics which built on the new generation of RDNA 3.5 architecture AMD graphics, it brings ultra-high frame rate experiences and advanced content creation features anywhere and delivers staggering performance. It can handle all your computing and multimedia tasks efficiently.</span></blockquote><blockquote><span class="a-list-item">【Support Copilot】This Mini PC supports Copilot. Copilot is an AI companion that works anywhere and intelligently adapts to your needs, helps you inspire writing inspiration and sumarize long articles, it also can helps you work prodctive, increase your creativity and stay connected to the people and things in your life.</span></blockquote><blockquote><span class="a-list-item">【Dual 2.5G Lan Port and Wi-Fi 7 Support】It comes with Two 2.5G Lan Ports for wired connection and and Wi-Fi 7 / BT5.4 for wireless connection, which increased the network speed greatly and expand its functions and improved performance of computer to a large extent and allows you to use more networks such as software routers (OpenWRT / DD-WRT / Tomato etc.), firewalls, NAT, network isolation etc.</span></blockquote><blockquote><span class="a-list-item">【OCulink Support】This mini pc was equipped with a OCulink port. OCuLink is a standard for externally connecting PCI Express, the speed is PCIe4.0 x4=64G. With this port, you could install external GPU with faster support speeds compared to Thunderbolt 4 and USB4. Note: *Non-hot-swappable, OCulink requires one M.2 2280 PCIe4.0 SSⅮslot*.</span></blockquote><blockquote><span class="a-list-item">【Four Video Outputs】 This X1 Pro Computer is Equipped with 1x HDMI, 1x DP and 2x USB4 Outputs, you can connect 4 displays at the same time. Increase work efficiency by expanding multiple workspaces. It is used in fields that require high-performance computing and graphics processing, including digital signage and securities trading, as well as work that uses CAD, such as engineering design, scientific calculations, animation production, and post-production for movies and television. These are typically used by individual users or experts in their field.</span></blockquote><blockquote><span class="a-list-item">【Expandable Storage】 This Micro Computer has pre-installed 64GB DDR5 RAM(Dual SO-DIMM Slot, up to 96GB) and 1TB M.2 2280 PCIe4.0 SSD. You could expand the SSD up to 4TB. There two more PCIe4.0 SSD slots available for expanding the storage, total up to 12TB. Without worrying about lack of capacity, you can run software smoothly, watch and storage large-scale movies, photos without any stress.</span></blockquote><p> </p><p>As the mid-tier option of the 3 configurations of this specific miniPC, the main weakness is the 1TB SSD. AI models are in the tens of gigabytes, and with certain AI related applications unable to store data on other drives, this means a <strong>lot </strong>of space is going to be used on the primary drive. Even worse, quality 2TB drives have not hit the $100 or less mark, so replacing the drive is not an easy task, even if you flip the original drive on the used market.</p><p>However, the 64GB of RAM means that you can allocate at least 32 GB to the GPU, which <strong>will </strong>affect AI and graphics workloads. (Confusingly, Minisforum does not provide a 48GB RAM option.) This RAM is slower than LPDDR5X soldered to a Strix Halo or some competing Strix Point miniPC motherboards, but you can upgrade it for speed and/or capacity later, which is an advantage over its lifespan.</p><p>It also has <strong>three </strong>NVMe SSD slots, which is good, because the Occulink connector that allows for the use of an external GPU will completely remove the bandwidth for one of the SSDs. This gives the X1 Pro an advantage against other Strix Point based miniPCs, since they tend to have only <strong>two </strong>NVMe SSD slots.</p><p>Overall AI performance is hard to assess, for two main reasons:</p><ol><li>Neural Processing Units (NPUs) are generally not supported by AI software.</li><li>Total AI performance from combining NPU + GPU is not available.</li></ol><p>There seems to be a chicken and the egg problem with NPUs. The hardware vendors expected the open source AI developer community to develop the software integrations for the NPUs, but that never happened. So now the vendors (AMD and Intel) are developing the software required to run AI on the NPU.</p><p>Since this is the best NPU outside of Strix Halo, I plan to test NPU only and NPU + GPU performance where possible.</p><p>In terms of price, <a href="https://camelcamelcamel.com/product/B0F47G69MJ" title="Camel Camel Camel price graph for X1 Pro miniPC." target="_blank" rel="noopener noreferrer">this graph</a> tells the story quite well:</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-002.png" alt="Camel Camel Camel price graph for the X1 Pro throughout its product life." width="1920" height="921" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-002-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-002-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-002-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-002-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-002-xl.png 1600w"></figure><p>The device has basically ping-ponged between a few cents below $1000 and a few cents below $1250, with occasional coupons to bring it back down to $1000. (Camel Camel Camel does not seem to track coupons.) Therefore, buying it during the Florida sales tax holiday on computer hardware under $1500 made this the best price/performance option I could choose.</p><h2 id="mcetoc_1j2ff0lemv6">The Alternatives</h2><p>I had two main other options:</p><ol><li>Gut an old HP office desktop and replace the internals.</li><li>Build a new small PC from scratch.</li></ol><div class="gallery-wrapper"><div class="gallery" data-is-empty="false" data-translation="Add images" data-columns="2"><figure class="gallery__item"><a href="https://korgano.github.io/media/posts/46/gallery/minipc-003.jpg" data-size="2000x567"><img loading="lazy" src="https://korgano.github.io/media/posts/46/gallery/minipc-003-thumbnail.jpg" alt="Side by side comparison of the X1 Pro and a 2013 HP office desktop." width="768" height="218"></a></figure><figure class="gallery__item"><a href="https://korgano.github.io/media/posts/46/gallery/minipc-004.jpg" data-size="2000x1062"><img loading="lazy" src="https://korgano.github.io/media/posts/46/gallery/minipc-004-thumbnail.jpg" alt="Top down comparison of the X1 Pro and a 2013 HP office desktop." width="768" height="408"></a></figure></div></div><p>The old HP desktop was procured somewhere in the 2012-2013 time frame for use by grandmother, and came into my possession after she moved several years later. With a barely adequate for the time Intel i3 processor, the case was of an ideal size to house powerful hardware, while also serving as a mounting place for its own monitor. However, there were two main problems.</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-005.jpg" alt="Interior of the 2013 HP office desktop case with no hard drive." width="2000" height="1500" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-005-xs.jpg 384w, https://korgano.github.io/media/posts/46/responsive/minipc-005-sm.jpg 600w, https://korgano.github.io/media/posts/46/responsive/minipc-005-md.jpg 768w, https://korgano.github.io/media/posts/46/responsive/minipc-005-lg.jpg 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-005-xl.jpg 1600w"></figure><ol><li>The case only has half-height slots for PCI-E devices.</li><li>The non-standard form factor power supply.</li></ol><p>Despite supporting regular sized motherboards and a great deal of internal volume, the case's two flaws are killers. Half height PCI-E slots dramatically reduce the number of add-in devices you can use in you computer, <strong>especially </strong>graphics cards, which are useful for AI and other work loads.</p><p>Even worse is the power supply, which uses the expensive and lower availability TFX standard. With a 180 watt power rating and a single SATA power connector, this would have to be replaced with at least a 300W power supply to accomplish anything useful.</p><p>Since that would leave me with nothing but a case, I decided to look at building a new PC from scratch.</p><p>Because I don't live in Miami, I don't have access to MicroCenter, a brick and mortar PC hardware store that has many great deals on a regular basis. Doing some quick research, I found that ~$300 was the minimum price I would expect for an M-ATX motherboard and CPU combination, especially if I wanted WiFi. Minisforum motherboards with integrated high-end mobile CPUs like the <a href="https://www.amazon.com/MINISFORUM-Motherboard-i9-13900HX-Barebone-PCIe5-0x16/dp/B0CTTPFZD5" title="MINISFORUM BD795m Mini PC Motherboard AMD Ryzen 9 7945HX DDR5 Barebone Gaming PC, 2X PCIe4.0 SSD,2xSATA3.0 HDD/SSD, HDMI2.1|DP1.4|, M.2 2230 Key E Slot" target="_blank" rel="noopener noreferrer">BD795m</a> or the <a href="https://www.amazon.com/MINISFORUM-Motherboard-Channel-PCIe5-0x16-Graphics/dp/B0CNPZ874Y" title="MINISFORUM BD795i SE Motherboard AMD Ryzen 9 7945HX(16C/32T) Gaming Mini PC Without RAM/SSD/OS, 2X DDR5 SODIMM Slots, 2X PCIe4.0 SSD, M.2 2230 Key E Slot, HDMI+DP+USB-C Triple Video Outputs Computer" target="_blank" rel="noopener noreferrer">BD795i SE</a> offered incredible CPU price/performance, but cost between $364 and $384, while lacking WiFi.</p><p>In fact, the big problem with building a PC at the moment is that to build anything good, one needs to buy a 16GB GPU. And since that is currently highly in demand due to <strong>years </strong>of VRAM undersupply, even the cheapest models cost above $300.</p><p>So the costs added up quite quickly, and since I didn't necessarily need GPU performance as much as VRAM, something that came with all the hardware and good enough graphical performance became a more appealing option.</p><h2 id="mcetoc_1j2ff0lemv7">Setting up the X1 Pro</h2><p>Once I received the miniPC from Amazon, I began configuring it for my uses.</p><p>The first thing I did was run through the Windows 11 setup to figure out which version of the OS was installed. The store listings and reviews didn't specify which Windows 11 version Minisforum installed on the PC, which prevented me from preparing a clean, optimized version of the OS to install. Checking the About PC menu, I discovered the following:</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-006.jpg" alt="X1 Pro default Windows installation - Windows 11 Pro." width="2000" height="1500" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-006-xs.jpg 384w, https://korgano.github.io/media/posts/46/responsive/minipc-006-sm.jpg 600w, https://korgano.github.io/media/posts/46/responsive/minipc-006-md.jpg 768w, https://korgano.github.io/media/posts/46/responsive/minipc-006-lg.jpg 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-006-xl.jpg 1600w"></figure><p>Armed with the knowledge that I needed Windows 11 Pro, I followed this Chris Titus Tech guide to download and optimize a Windows 11 Pro ISO. I also copied my laptop's installed software using Chris Titus' WinUtil.</p><p>Once I had the ISO prepared, I placed it on my Ventoy USB stick, and installed it on the X1 Pro, overwriting the existing installation. Unfortunately, there were device specific drivers that I had to obtain to reactivate the WiFi, which slowed things down.</p><p>Once those were installed, I updated Windows and obtained the latest AMD graphics and chipset drivers. Following a reboot, I imported the laptop's software list, deselected a few software choices, then auto-installed everything via WinGet. After that was implementation of the recommended settings to disable telemetry and other background tasks.</p><p>The process took a little over 3 hours, primarily due to the need to find an alternate, safe download source for Windows 11.</p><p>In addition, I made sure to access the BIOS/UEFI and set 32GB of RAM to be dedicated GPU memory. The AMD driver software stack does allow for dynamic allocation of RAM between the CPU and GPU, but I felt it prudent to ensure that there was a 50/50 split in case of a workload that heavily utilized both components.</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-007.png" alt="AMD Lemonade Server install interface, including the option to download models optimized for use with NPU+GPU operations." width="499" height="388" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-007-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-007-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-007-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-007-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-007-xl.png 1600w"></figure><p>Afterwards, I installed <a href="https://github.com/lemonade-sdk/lemonade" title="Lemonade: Local LLM Serving with GPU and NPU acceleration" target="_blank" rel="noopener noreferrer">Lemonade Server</a>, an AMD developed piece of software for hosting and running local LLMs that use the various processors on the machine. Most importantly, it can use the NPU and integrated GPU (iGPU) to run LLMs. This is a rarity in the software landscape.</p><p>However, installing it was a bit of an ordeal, as the Windows installer made use of PowerShell scripts. This required reconfiguring the Windows Developer settings, something that I did not remember to do on the first attempt. Also annoying was the default setting for the target directory, which I overrode, and the target for LLMs, which I did not and had to pin to Quick Access.</p><p>To serve as a Retrieval Augmented Generation system and LLM interface, I installed AnythingLLM and copied three sets of documents from my gaming rig to the new system. Since Lemonade Server uses the OpenAI API, I can easily connect the LLMs running in that program to AnythingLLM, albeit with an annoying process to change the models. (Since AnythingLLM doesn't have specific Lemonade support, going through the OpenAI API requires manually changing the model every time you load a different model.)</p><p>I had to spend 10+ hours installing an Unreal Engine 5.5.4 modding Software Development Kit (SDK). This was due to two main factors:</p><ol><li>Epic Game Store's inability to detect/add EGS library folders and associate the files within those folders with the library on that specific machine.</li><li>Installing to a SATA SSD over USB 3.0.</li></ol><p>Once that was complete, I was done setting up the X1 Pro for my intended uses.</p><h2 id="mcetoc_1j2ff0lemv8">Stress Testing the X1 Pro</h2><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-008-2.png" alt="MechWarrior 5: Clans modding SDK based on Unreal Engine 5.5.4 - GPU load of 50+%." width="1920" height="1080" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-008-2-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-008-2-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-008-2-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-008-2-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-008-2-xl.png 1600w"></figure><p>I decided to take a two pronged approach to initial stress testing of the miniPC. The first prong was to run Unreal Engine 5.5.4, in the form of the MechWarrior 5: Clans modding SDK. The software has a pretty heavy CPU and GPU load even on a desktop system, like my Ryzen 7 7800X3D + RX 7900 XTX system, so if the miniPC can run it in any capacity, that is quite impressive.</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-009.png" alt="MechWarrior 5: Clans modding SDK based on Unreal Engine 5.5.4 - CPU load of 25+%." width="1920" height="1080" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-009-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-009-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-009-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-009-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-009-xl.png 1600w"></figure><p>As I discovered, the X1 Pro <strong>can </strong>run the modding SDK, but the load on the hardware is highly variable and depends on where in the process you take readings. For example, while GPU usage is consistently in the 50-60% range, CPU utilization can spike violently in the initial load process, even hitting up to 80+% at some points.</p><figure class="post__image"><img loading="lazy" src="https://korgano.github.io/media/posts/46/minipc-010.png" alt="MechWarrior 5: Clans modding SDK based on Unreal Engine 5.5.4 - CPU load of 98%." width="1920" height="1080" sizes="(min-width: 37.5em) 1600px, 80vw" srcset="https://korgano.github.io/media/posts/46/responsive/minipc-010-xs.png 384w, https://korgano.github.io/media/posts/46/responsive/minipc-010-sm.png 600w, https://korgano.github.io/media/posts/46/responsive/minipc-010-md.png 768w, https://korgano.github.io/media/posts/46/responsive/minipc-010-lg.png 1200w, https://korgano.github.io/media/posts/46/responsive/minipc-010-xl.png 1600w"></figure><p>However, the most punishing workload is packaging a mod for release. In this case, I had a simple mod consisting of two fairly small image files and around two dozen files that would generate shop items. Generating the files to make the mod playable essentially maxed out the CPU. In fact, when I did the same process a second time, but included a step to push the files to Steam Workshop for hosting, the process caused the GPU driver to crash at some point after the upload completed.</p><p>It's not entirely clear why the GPU driver crashed, but a bug report was submitted to AMD. It's possible that thermal throttling contributed to the problem, which may require a third party application like Universal x86 Tuning Application to address:</p><figure class="post__video"><iframe loading="lazy" width="560" height="314" src="https://www.youtube-nocookie.com/embed/9nkDPKbPdGc" allowfullscreen="allowfullscreen" data-mce-fragment="1"></iframe></figure><p>The second prong of the testing was LLM performance with a repeatable task. To do this, I intended to try NPU + GPU and GPU only performance by submitting this prompt to an LLM:</p><blockquote><p>revise this code for FreeBSD to ensure iwlwifi0_wlan is enabled and remains functioning at all times:</p><p>```<br>#!/bin/sh<br>#<br># PROVIDE: wpa_supplicant<br># REQUIRE: NETWORKING<br># KEYWORD: shutdown</p><p>./etc/rc.subr<br>./etc/network.subr</p><p>name="wpa_supplicant"</p><p>desc="WPA/802.11 Supplicant for wireless network devices" rcvar=wpa_supplicant_enable</p><p>ifn="2"<br>if [ -z "$ifn" ]; then<br>       return 1</p><p>fi</p><p>if is_wired_interface $(ifn) ; then<br>       drivers="wired"<br>else<br>       drivers="bsd"<br>fi</p><p>load_rc_config $name</p><p>command=$(wpa_supplicant_program)<br>conf_file=$(wpa_supplicant_conf_file)<br>pidfile="/var/run/$(name)/$(ifn).pid"<br>command_args="-B -i -ifn -c $conf_file -D $driver -P $pidfile" required_files=$conf_file<br>required_modules="wlan_wep wlan_tkip wlan_ccmp"</p><p>run_rc_command "$1"</p><p>```</p><p>Add comments as needed to explain code functionality and speed up troubleshooting.</p></blockquote><p>Unfortunately, version 1.8 of Lemonade Server is missing a dependency in its installer, which prevents NPU + GPU operation on Windows. Annoyingly, v1.8.2 keeps getting flagged as a trojan, despite Virus Total saying the .exe file is clean, preventing me from updating and seeing if that corrects the problem. </p><p>So I was only able to conduct GPU only testing, with a tuned version of OpenAI's open source model: <a href="https://huggingface.co/DavidAU/Openai_gpt-oss-20b-CODER-NEO-CODE-DI-MATRIX-GGUF" title="DavidAU/Openai_gpt-oss-20b-CODER-NEO-CODE-DI-MATRIX-GGUF" target="_blank" rel="noopener noreferrer">Openai_gpt-oss-20b-CODER-NEO-CODE-DI-MATRIX-GGUF</a>. I used AnythingLLM for the conversation GUI and stock settings on the X1 Pro. On the 7800X3D + RX 7900 XTX system, I used LM Studios and a special creative reasoning system prompt. On both systems, Llama.cpp's Vulkan code execution was used. The results were as follows:</p><table style="border-collapse: collapse; width: 100%;" border="1"><tbody><tr><td style="width: 16.4005%;">System</td><td style="width: 18.1118%;">Tokens/Sec</td><td style="width: 32.8009%;">Tokens</td><td style="width: 32.8009%;">Time to First Token</td></tr><tr><td style="width: 16.4005%;">X1 Pro</td><td style="width: 18.1118%;">24.22</td><td style="width: 32.8009%;">2767</td><td style="width: 32.8009%;">0.84713</td></tr><tr><td style="width: 16.4005%;">7800X3D + 7900 XTX</td><td style="width: 18.1118%;">135.05</td><td style="width: 32.8009%;">1352</td><td style="width: 32.8009%;">0.30s</td></tr></tbody></table><p>The X1 Pro is clearly the slower and less capable of the two, with roughly 18% the tokens/sec of the larger, dedicated GPU, and roughly 282% longer time to first token.</p><p>However, it did produce <strong>way </strong>more in depth code, at just over 2x the tokens, which I attribute to an unexpected interaction between the system prompt and the LLM in LM Studio. In terms of the experience of using the LLM, I was impressed by the speed of the LLM once began producing tokens, as well as the quality of said code.</p><h2>Takeaways</h2><ul><li>The X1 Pro is a compromise option that is highly functional in the current constraints of the market.<ul><li>However, I do not recommend spending more than $1000 on the 64GB RAM + 1TB SSD configuration.</li></ul></li><li>The X1 Pro is a space efficient design with good acoustics when the fans spin up.</li><li>Loading Unreal Engine 5 projects with lots of assets is doable, but will heavily load the CPU at various times, and moderately load the GPU. <ul><li>I have not tested in-engine gameplay testing, but I do not think it will end well.</li><li>Occasional GPU driver shutdowns can occur when doing strenuous workloads.</li></ul></li><li>Software support on Windows for the HX 370 processor's NPU is a bottleneck.</li><li>Lemonade Server is an effective tool for running LLMs, despite some dependency and update issues.</li><li>Using Vulkan and Llama.cpp, at least 24 tokens/second can be achieved on the GPU for LLM tasks.<ul><li>If time to completion is not a major constraint, lower speed in exchange for more ability to run larger parameter size LLMs is a valid trade off.</li></ul></li></ul><p>Overall, at this moment, my assessment is that the X1 Pro is a good-enough jack-of-all-trades workstation that can get just about any task done, to some level of satisfaction.</p></div><footer class="content__footer"><div class="content__tag-share"><div class="content__tag"><h3 class="content__tag__title">Posted in</h3><ul class="content__tag__list"><li><a href="https://korgano.github.io/tags/ai/">AI</a></li><li><a href="https://korgano.github.io/tags/pc/">PC</a></li><li><a href="https://korgano.github.io/tags/pc-hardware/">PC Hardware</a></li><li><a href="https://korgano.github.io/tags/tech/">Tech</a></li><li><a href="https://korgano.github.io/tags/tech-projects/">Tech Projects</a></li></ul></div><div class="content__share"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fkorgano.github.io%2Ftech-project-ai-minipc-minisforum-x1-pro-10%2F" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg><use xlink:href="https://korgano.github.io/assets/svg/svg-map.svg#linkedin"/></svg></a></div></div></footer></div></article><div class="content__related"><h3 class="content__related__title">Related posts</h3><div class="l-grid l-grid--2"><article class="c-card"><div class="c-card__wrapper"><figure class="c-card__image is-img-loading"><img src="https://korgano.github.io/media/posts/14/EGS-account-pub-serv.PNG" srcset="https://korgano.github.io/media/posts/14/responsive/EGS-account-pub-serv-xs.PNG 384w, https://korgano.github.io/media/posts/14/responsive/EGS-account-pub-serv-sm.PNG 600w, https://korgano.github.io/media/posts/14/responsive/EGS-account-pub-serv-md.PNG 768w, https://korgano.github.io/media/posts/14/responsive/EGS-account-pub-serv-lg.PNG 1200w" sizes="(min-width: 37.5em) 80vw, 50vw" loading="lazy" height="860" width="1600" alt="Wireshark Packet Capture of traffic to domain account-public-service-prod03.ol.epicgames.com"></figure><div class="c-card__content"><header><h2 class="c-card__title"><a href="https://korgano.github.io/cybersecurity-project-epic-games-store-packet-capture-ips-1/" class="invert">Cybersecurity Project: Epic Games Store Packet Capture - IPs 1</a></h2></header><footer class="c-card__meta"><a href="https://korgano.github.io/tags/cybersecurity-projects/" class="c-card__tag">Cybersecurity Projects</a></footer></div></div></article><article class="c-card"><div class="c-card__wrapper"><figure class="c-card__image is-img-loading"><img src="https://korgano.github.io/media/posts/13/suspicious-ip-loc-2.PNG" srcset="https://korgano.github.io/media/posts/13/responsive/suspicious-ip-loc-2-xs.PNG 384w, https://korgano.github.io/media/posts/13/responsive/suspicious-ip-loc-2-sm.PNG 600w, https://korgano.github.io/media/posts/13/responsive/suspicious-ip-loc-2-md.PNG 768w, https://korgano.github.io/media/posts/13/responsive/suspicious-ip-loc-2-lg.PNG 1200w" sizes="(min-width: 37.5em) 80vw, 50vw" loading="lazy" height="827" width="1600" alt="The most suspicious possible IP address location - the middle of a reservoir in Kansas."></figure><div class="c-card__content"><header><h2 class="c-card__title"><a href="https://korgano.github.io/cybersecurity-project-epic-games-store-packet-capture-ip-addresses/" class="invert">Cybersecurity Project: Epic Games Store Packet Capture - Domains</a></h2></header><footer class="c-card__meta"><a href="https://korgano.github.io/tags/cybersecurity-projects/" class="c-card__tag">Cybersecurity Projects</a></footer></div></div></article></div></div></main><footer class="footer"><div class="footer__left"><div class="footer__copy">Copyright Xavier Santana, 2023-2024. Powered by Publii.</div></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://korgano.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = { mobileMenuMode: 'sidebar', animationSpeed: 300, submenuWidth: 'auto', doubleClickTime: 500, mobileMenuExpandableSubmenus: true, relatedContainerForOverlayMenuSelector: '.navbar', };</script><script defer="defer" src="https://korgano.github.io/assets/js/scripts.min.js?v=9c5ab7a87221183f149a42b3cceb7956"></script><script>function publiiDetectLoadedImages () {
         var images = document.querySelectorAll('img[loading]:not(.is-loaded)');
         for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
               images[i].classList.add('is-loaded');
               images[i].parentNode.classList.remove('is-img-loading');
            } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
                  this.parentNode.classList.remove('is-img-loading');
               }, false);
            }
         }
      }
      publiiDetectLoadedImages();</script><script defer="defer" src="https://korgano.github.io/assets/js/photoswipe.min.js?v=017385b552f7e0d979e2e2fe6f324015"></script><script defer="defer" src="https://korgano.github.io/assets/js/photoswipe-ui-default.min.js?v=d067f0883540b1ddda0e2c9ad1b14260"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
   linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
   if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
   item.el=figureEl;items.push(item);}
   return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
   var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
   if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
   nodeIndex++;}
   if(index>=0){openPhotoSwipe(index,clickedGallery);}
   return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
   var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
   var pair=vars[i].split('=');if(pair.length<2){continue;}
   params[pair[0]]=pair[1];}
   if(params.gid){params.gid=parseInt(params.gid,10);}
   return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
   mainClass:'pswp--dark',
   preload: [1,2],
   hideAnimationDuration:200,
   showAnimationDuration:0,
   bgOpacity: 0.7,
   showHideOpacity:true,
   closeOnScroll: true,
   arrowKeys: true,
   closeEl: true,
   captionEl: true,
   fullscreenEl: true,
   zoomEl: true,
   shareEl: true,
   counterEl: true,
   arrowEl: true,
   preloaderEl: true
   };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
   if(isNaN(options.index)){return;}
   if(disableAnimation){options.showAnimationDuration=0;}
   gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
   var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};window.addEventListener('load', function () {initPhotoSwipeFromDOM('.gallery');}, false);</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button><button class="pswp__button pswp__button--share" title="Share"></button><button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button><button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script><script defer="defer" src="https://korgano.github.io/media/plugins/syntaxHighlighter/prism-show-invisibles.min.js"></script><!-- Start main cookie container --><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="90" data-debug-mode="false"><!-- Start Banner --><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">This website uses cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://korgano.github.io/privacy-policy/">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><!-- End of Banner --><!-- Badge --> <button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button><!-- End of Badge --></div><!-- End of main cookie container --><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        initialLsState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('🍪 Config not found, or configuration expired');
            }

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                    'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                    'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                    'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                    'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                    'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                    'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                });  
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': window.publiiCBGCM.defaultState.ad_storage ? 'granted' : 'denied',
                        'ad_personalization': window.publiiCBGCM.defaultState.ad_personalization ? 'granted' : 'denied',
                        'ad_user_data': window.publiiCBGCM.defaultState.ad_user_data ? 'granted' : 'denied',
                        'analytics_storage': window.publiiCBGCM.defaultState.analytics_storage ? 'granted' : 'denied',
                        'personalization_storage': window.publiiCBGCM.defaultState.personalization_storage ? 'granted' : 'denied',
                        'functionality_storage': window.publiiCBGCM.defaultState.functionality_storage ? 'granted' : 'denied',
                        'security_storage': window.publiiCBGCM.defaultState.security_storage ? 'granted' : 'denied'
                    }));
                }
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('🍪 Config founded');
            }

            cbConfig.initialLsState = currentConfig.split(',');

            if (window.publiiCBGCM) {
                gtag('consent', 'default', {
                    'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                    'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                    'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                    'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                    'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                    'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                    'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                });
                
                if (cbConfig.debugMode) {
                    console.log('🍪 GCMv2 DEFAULT STATE: ' + JSON.stringify({
                        'ad_storage': getDefaultConsentState(currentConfig, 'ad_storage'),
                        'ad_personalization': getDefaultConsentState(currentConfig, 'ad_personalization'),
                        'ad_user_data': getDefaultConsentState(currentConfig, 'ad_user_data'),
                        'analytics_storage': getDefaultConsentState(currentConfig, 'analytics_storage'),
                        'personalization_storage': getDefaultConsentState(currentConfig, 'personalization_storage'),
                        'functionality_storage': getDefaultConsentState(currentConfig, 'functionality_storage'),
                        'security_storage': getDefaultConsentState(currentConfig, 'security_storage')
                    }));
                }
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function getDefaultConsentState (currentConfig, consentGroup) {
        let configGroups = currentConfig.split(',');

        for (let i = 0; i < configGroups.length; i++) {
            let groupName = configGroups[i];
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === groupName);

            if (group && group[consentGroup]) {
                return 'granted';
            }
        }  
        
        if (window.publiiCBGCM.defaultState[consentGroup]) {
            return 'granted'; 
        }
        
        return 'denied';
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('🍪 Allowed group: ' + allowedGroup);
        }

        if (window.publiiCBGCM && (!cbConfig.initialLsState || cbConfig.initialLsState.indexOf(allowedGroup) === -1)) {
            let consentResult = {};
            let group = window.publiiCBGCM.groups.find(group => group.cookieGroup === allowedGroup);

            if (group) {
                let foundSomeConsents = false;

                Object.keys(group).forEach(key => {
                    if (key !== 'cookieGroup' && group[key] === true) {
                        consentResult[key] = 'granted';
                        foundSomeConsents = true;
                    }
                });

                if (foundSomeConsents) {
                    gtag('consent', 'update', consentResult);   

                    if (cbConfig.debugMode) {
                        console.log('🍪 GCMv2 UPDATE: ' + JSON.stringify(consentResult));
                    }
                }
            }
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('🍪 Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('🍪 Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('🍪 Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupToCheck !== '' && groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('🍪 Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('🍪 Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>